// -- M E S S G E S -- //

var messages_chat_list_items = [
	{
		"name" : "John",
		"status" : "offline",
		"messages" : [
			{
				"send_by" : "person",
				"content" : "Did you try this scroll feature?",
				"time" : "9:07 PM"
			},
			{
				"send_by" : "person",
				"content" : "It's really cool",
				"time" : "9:07 PM"
			},
			{
				"send_by" : "you",
				"content" : "Not yet, how can i try it?",
				"time" : "9:08 PM"
			},
			{
				"send_by" : "person",
				"content" : "Just hold cursor over the weather widget and scroll mouse wheel",
				"time" : "9:09 PM"
			},
			{
				"send_by" : "person",
				"content" : "Oh, and don't forget to hold Shift",
				"time" : "9:09 PM"
			},
			{
				"send_by" : "person",
				"content" : "Did it work?",
				"time" : "9:11 PM"
			},
		]
	},
	{
		"name" : "Jane",
		"status" : "offline",
		"messages" : [
			{
				"send_by" : "you",
				"content" : "Hi, Jane. I can't figure out how tab system works",
				"time" : "9:13 PM"
			},
			{
				"send_by" : "person",
				"content" : "Oh, there are guidelines on Github",
				"time" : "9:17 PM"
			},
			{
				"send_by" : "you",
				"content" : "Can you send me the link?",
				"time" : "9:18 PM"
			},
			{
				"send_by" : "person",
				"content" : "<a href='https://docs.avdanos.com/demo/demo-intro' target='_blank'>Avdan Demo</a>",
				"time" : "9:18 PM"
			},
			{
				"send_by" : "person",
				"content" : "But it will be easier for me to explain it here",
				"time" : "9:19 PM"
			},
			{
				"send_by" : "you",
				"content" : "So, how can i use tabs?",
				"time" : "9:21 PM"
			},
			{
				"send_by" : "person",
				"content" : "Double click to close it, if it's not the first one in a row",
				"time" : "9:22 PM"
			},
			{
				"send_by" : "person",
				"content" : "Drag it to swap",
				"time" : "9:22 PM"
			},
			{
				"send_by" : "person",
				"content" : "In that case you can change it's place dropping it over other tabs in the same window",
				"time" : "9:23 PM"
			},
			{
				"send_by" : "you",
				"content" : "?!",
				"time" : "9:24 PM"
			},
			{
				"send_by" : "person",
				"content" : "Just try it",
				"time" : "9:24 PM"
			},
			{
				"send_by" : "you",
				"content" : "It really works ü§®",
				"time" : "9:26 PM"
			},
			{
				"send_by" : "person",
				"content" : "That's not all",
				"time" : "9:26 PM"
			},
			{
				"send_by" : "you",
				"content" : "Really?",
				"time" : "9:26 PM"
			},
			{
				"send_by" : "person",
				"content" : "Yes, you can also tile a window using tabs",
				"time" : "9:27 PM"
			},
			{
				"send_by" : "you",
				"content" : "üòµ‚Äçüí´",
				"time" : "9:27 PM"
			},
			{
				"send_by" : "person",
				"content" : "Just hold Ctrl and press a tab",
				"time" : "9:28 PM"
			},
			{
				"send_by" : "person",
				"content" : "You'll see",
				"time" : "9:28 PM"
			},
			{
				"send_by" : "person",
				"content" : "You can also drag and drop it out of the window",
				"time" : "9:29 PM"
			},
			{
				"send_by" : "person",
				"content" : "Or you can even drop it in another window üòè",
				"time" : "9:31 PM"
			},
			{
				"send_by" : "person",
				"content" : "So, what do you think about it?",
				"time" : "9:31 PM"
			},
		]
	},
	{
		"name" : "James",
		"status" : "offline",
		"messages" : [
			{
				"send_by" : "person",
				"content" : "Well, i told you 100 times to try it",
				"time" : "1:20 PM"
			},
			{
				"send_by" : "person",
				"content" : "Are you here?",
				"time" : "1:22 PM"
			},
			{
				"send_by" : "you",
				"content" : "Yes, i was busy, so, what are you talking about?",
				"time" : "9:03 PM"
			},
			{
				"send_by" : "person",
				"content" : "ü§®",
				"time" : "9:07 PM"
			},
			{
				"send_by" : "person",
				"content" : "I said you about app icon swapping",
				"time" : "9:09 PM"
			},
			{
				"send_by" : "person",
				"content" : "You can drag it and change their order",
				"time" : "9:09 PM"
			},
			{
				"send_by" : "person",
				"content" : "They are in the dock below",
				"time" : "9:10 PM"
			},
			{
				"send_by" : "person",
				"content" : "There's also an arrow to hide them",
				"time" : "9:12 PM"
			},
			{
				"send_by" : "person",
				"content" : "You can place unused apps after the line and hide them it üòå",
				"time" : "9:13 PM"
			},
			{
				"send_by" : "person",
				"content" : "It saves a lot of place",
				"time" : "9:13 PM"
			},
			{
				"send_by" : "person",
				"content" : "I wrote about it to Jane, but she didn't answer",
				"time" : "9:15 PM"
			},
			{
				"send_by" : "person",
				"content" : "Do you know where she is?",
				"time" : "9:15 PM"
			},
			{
				"send_by" : "person",
				"content" : "Hey, where you are?",
				"time" : "9:17 PM"
			},
		]
	},
	{
		"name" : "William",
		"status" : "offline",
		"messages" : [
			{
				"send_by" : "person",
				"content" : "This AvdanOS is amazing",
				"time" : "8:47 PM"
			},
			{
				"send_by" : "person",
				"content" : "I can drop a window in another window",
				"time" : "8:48 PM"
			},
			{
				"send_by" : "person",
				"content" : "And it will tile it, the same thing works with draggable tabs",
				"time" : "8:48 PM"
			},
			{
				"send_by" : "person",
				"content" : "Or you can just drop them in window's topbar",
				"time" : "8:50 PM"
			},
			{
				"send_by" : "you",
				"content" : "And what will happen? I'm busy, so i can't test it",
				"time" : "9:52 PM"
			},
			{
				"send_by" : "person",
				"content" : "It will add it without tilling",
				"time" : "9:53 PM"
			},
			{
				"send_by" : "person",
				"content" : "It's hard to notice from the first try",
				"time" : "8:53 PM"
			},
			{
				"send_by" : "you",
				"content" : "Oh, really?!",
				"time" : "9:11 PM"
			},
			{
				"send_by" : "you",
				"content" : "It's cool",
				"time" : "9:11 PM"
			},
		]
	},
	{
		"name" : "Sarah",
		"status" : "offline",
		"messages" : [
			{
				"send_by" : "you",
				"content" : "I accidentally dragged a bar in dock",
				"time" : "9:24 PM"
			},
			{
				"send_by" : "you",
				"content" : "Is it a bug?",
				"time" : "9:24 PM"
			},
			{
				"send_by" : "person",
				"content" : "No, you can merge and unmerge them",
				"time" : "9:26 PM"
			},
			{
				"send_by" : "you",
				"content" : "Wow",
				"time" : "9:27 PM"
			},
		]
	},
];

class Messages {

	static content;
	static title = "Messages";
	static src = "src/images/demo/icons/Apps/Messages.png";
	static extraClass = [];
	
	static {
		var messages_content = document.createElement("div");
		messages_content.classList.add("messages-content");

		var messages_left_side = document.createElement("div");
		messages_left_side.classList.add("messages-left-side");

		var messages_search_chat = document.createElement("div");
		messages_search_chat.classList.add("messages-search-chat");

		var messages_search_chat_input = document.createElement("input");
		messages_search_chat_input.setAttribute("type", "text");
		messages_search_chat_input.setAttribute("placeholder", "Search");

		var messages_search_chat_icon = document.createElement("img");
		messages_search_chat_icon.src = "src/images/demo/icons/Search.png";

		messages_search_chat.appendChild(messages_search_chat_input);
		messages_search_chat.appendChild(messages_search_chat_icon);

		messages_left_side.appendChild(messages_search_chat);

		var messages_chat_list = document.createElement("div");
		messages_chat_list.classList.add("messages-chat-list");

		for (var i = 0; i < messages_chat_list_items.length; i++) {
			messages_chat_list_items[i].id = i;
		}

		messages_left_side.appendChild(messages_chat_list);

		var messages_right_side = document.createElement("div");
		messages_right_side.classList.add("messages-right-side");

		var messages_header = document.createElement("div");
		messages_header.classList.add("messages-header");

		var messages_header_icon_holder = document.createElement("div");
		messages_header_icon_holder.classList.add("messages-header-icon");

		var messages_header_icon = document.createElement("img");
		messages_header_icon.src = messages_chat_list_items[0].src || "src/images/demo/icons/Start/DefaultProfilePicture.png";

		var messages_header_info = document.createElement("div");
		messages_header_info.classList.add("messages-header-info");

		var messages_header_name = document.createElement("div");
		messages_header_name.classList.add("messages-header-name");
		messages_header_name.innerHTML = messages_chat_list_items[0].name;

		var messages_header_status = document.createElement("div");
		messages_header_status.classList.add("messages-header-status");
		messages_header_status.innerHTML = messages_chat_list_items[0].status;

		messages_header_icon_holder.appendChild(messages_header_icon);

		messages_header_info.appendChild(messages_header_name);
		messages_header_info.appendChild(messages_header_status);

		messages_header.appendChild(messages_header_icon_holder);
		messages_header.appendChild(messages_header_info);

		var messages_messages_list = document.createElement("div");
		messages_messages_list.classList.add("messages-messages-list");

		var messages_type = document.createElement("div");
		messages_type.classList.add("messages-type");

		var messages_type_input = document.createElement("input");
		messages_type_input.classList.add("messages-type-input");
		messages_type_input.setAttribute("type", "text");
		messages_type_input.setAttribute("placeholder", "Type a message");

		var messages_type_icon = document.createElement("img");
		messages_type_icon.src = "src/images/demo/icons/Messages/Emoji.png";

		messages_type.appendChild(messages_type_input);
		messages_type.appendChild(messages_type_icon);

		messages_right_side.appendChild(messages_header);
		messages_right_side.appendChild(messages_messages_list);
		messages_right_side.appendChild(messages_type);

		messages_content.appendChild(messages_left_side);
		messages_content.appendChild(messages_right_side);

		// -- //

		messages_content.classList.add("noselect");
		Messages.content = messages_content;
	}
	
	static async onclone(content) {
		for (var i = 0; i < messages_chat_list_items.length; i++) {
			var item = messages_chat_list_items[i];
			var messages_chat_list_item = document.createElement("div");
			messages_chat_list_item.classList.add("messages-chat-list-item");

			var messages_chat_list_item_icon_holder = document.createElement("div");
			messages_chat_list_item_icon_holder.classList.add("messages-chat-list-item-icon-holder");

			var messages_chat_list_item_icon = document.createElement("img");
			messages_chat_list_item_icon.src = item.src || "src/images/demo/icons/Start/DefaultProfilePicture.png";

			var messages_chat_list_item_info = document.createElement("div");
			messages_chat_list_item_info.classList.add("messages-chat-list-item-info");

			var messages_chat_list_item_name_line = document.createElement("div");
			messages_chat_list_item_name_line.classList.add("messages-chat-list-item-name-line");

			var messages_chat_list_item_name = document.createElement("span");
			messages_chat_list_item_name.classList.add("messages-chat-list-item-name");
			messages_chat_list_item_name.innerHTML = item.name;

			var messages_chat_list_item_date = document.createElement("span");
			messages_chat_list_item_date.classList.add("messages-chat-list-item-date");
			messages_chat_list_item_date.innerHTML = item.messages[item.messages.length-1].time;

			messages_chat_list_item_name_line.appendChild(messages_chat_list_item_name);
			messages_chat_list_item_name_line.appendChild(messages_chat_list_item_date);

			var messages_chat_list_item_message = document.createElement("span");
			messages_chat_list_item_message.classList.add("messages-chat-list-item-message");
			messages_chat_list_item_message.innerHTML = item.messages[item.messages.length-1].content;
			
			messages_chat_list_item_icon_holder.appendChild(messages_chat_list_item_icon);

			messages_chat_list_item_info.appendChild(messages_chat_list_item_name_line);
			messages_chat_list_item_info.appendChild(messages_chat_list_item_message);

			messages_chat_list_item.appendChild(messages_chat_list_item_icon_holder);
			messages_chat_list_item.appendChild(messages_chat_list_item_info);

			content.querySelector(".messages-chat-list").appendChild(messages_chat_list_item);
		}

		content.querySelector(".messages-chat-list").firstChild.style.backgroundColor = "var(--light-bg-hl)";

		var chat = content.querySelector(".messages-messages-list");
		chat.item_id = messages_chat_list_items[0].id;

		for (var i = 0; i < messages_chat_list_items[0].messages.length; i++) {
			var item = messages_chat_list_items[0].messages[i];
			var message_holder = document.createElement("div");
			message_holder.classList.add("message-holder");
			message_holder.classList.add(item.send_by);
			
			var messages_message = document.createElement("div");
			messages_message.classList.add("messages-message");
			messages_message.innerHTML = `${item.content}<sub>${item.time}</sub>`;

			message_holder.appendChild(messages_message);
			chat.appendChild(message_holder);
		}

		var messages_chat_list_children = content.querySelector(".messages-chat-list").children;
		var i = 0;

		var name = content.querySelector(".messages-header-name");
		var chat_status = content.querySelector(".messages-header-status");
		var chat_icon = content.querySelector(".messages-header-icon img");

		messages_chat_list_items.forEach(item => {
			messages_chat_list_children[i].addEventListener("click", e => {
				e.currentTarget.parentElement.querySelectorAll(".messages-chat-list-item").forEach(chat_item => {
					chat_item.style.backgroundColor = null;
				});
				e.currentTarget.style.backgroundColor = "var(--light-bg-hl)";
				
				name.innerHTML = item.name;
				chat_status.innerHTML = item.status;
				chat.innerHTML = "";
				chat.item_id = item.id;
				chat_icon.src = item.src || "src/images/demo/icons/Start/DefaultProfilePicture.png";

				item.messages.forEach(chat_item => {
					var message_holder = document.createElement("div");
					message_holder.classList.add("message-holder");
					message_holder.classList.add(chat_item.send_by);
					
					var messages_message = document.createElement("div");
					messages_message.classList.add("messages-message");
					messages_message.innerHTML = `${chat_item.content}<sub>${chat_item.time}</sub>`;

					message_holder.appendChild(messages_message);
					chat.appendChild(message_holder);
				});

			});
			i += 1;
		});

		var type_input = content.querySelector(".messages-type-input");
		type_input.addEventListener("keypress", e => {
			if (e.keyCode == 13 && type_input.value != "") {
				var date = new Date;
				var send_date = `${(date.getHours() >= 12) && (date.getHours() - 12) || date.getHours()}:${(date.getMinutes() < 10) && "0"+date.getMinutes() || date.getMinutes()} ${(date.getHours() >= 12) && 'PM' || 'AM'}`;

				messages_chat_list_items[chat.item_id].messages.push({
					"send_by" : "you",
					"content" : type_input.value,
					"time" : send_date

				});
					
				document.querySelectorAll(".messages-content").forEach(messages_content => {
					var message_holder = document.createElement("div");
					message_holder.classList.add("message-holder");
					message_holder.classList.add("you");
					
					var messages_message = document.createElement("div");
					messages_message.classList.add("messages-message");
					messages_message.innerHTML = `${type_input.value}<sub>${send_date}</sub>`;

					message_holder.appendChild(messages_message);
					var selected_chat = messages_content.querySelector(".messages-messages-list");
					if (selected_chat.item_id == chat.item_id) {
						selected_chat.appendChild(message_holder);
					}

					var curr_chat = messages_content.querySelector(".messages-chat-list").children[chat.item_id];
					curr_chat.querySelector(".messages-chat-list-item-message").innerHTML = type_input.value;
					curr_chat.querySelector(".messages-chat-list-item-date").innerHTML = send_date;
				});
				type_input.value = "";
			}
		});
	}
}
